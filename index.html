<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>hurl</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
        background-color: #1e1e1e;
      }

      .toolbar {
        height: 42px;
        background-color: transparent;
        border-bottom: 1px solid #2c2c2c;
        display: flex;
        align-items: center;
        gap: 0;
      }

      #commandLine {
        flex: 1;
        height: 40px;
        padding: 0 12px;
        border: 1px solid #343434;
        border-right: none;
        border-radius: 0;
        font-size: 14px;
        outline: none;
        background-color: #2c2c2c;
        color: #ffffff;
        margin: 0;
      }

      #commandLine:focus {
        border-color: #343434;
        box-shadow: none;
      }



      #textArea {
        flex: 1;
        border: none;
        background-color: #1e1e1e;
        color: #ffffff;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        font-size: 14px;
        padding: 12px;
        resize: none;
        outline: none;
      }
    </style>
  </head>
  <body>
    <div class="toolbar">
      <input
        type="text"
        id="commandLine"
        placeholder="커맨드를 입력하세요"
        value=""
      />

    </div>

    <textarea
      id="textArea"
      placeholder="커맨드 실행 결과가 여기에 표시됩니다"
      readonly
    ></textarea>

    <script>
      const commandLine = document.getElementById("commandLine");
      const textArea = document.getElementById("textArea");
      


      // JSON인지 확인하고 beautify하는 함수
      function formatOutput(output) {
        try {
          // 문자열을 trim하고 JSON 파싱 시도
          const trimmedOutput = output.trim();
          
          // JSON인지 확인 ({}나 []로 시작하는지 체크)
          if ((trimmedOutput.startsWith('{') && trimmedOutput.endsWith('}')) ||
              (trimmedOutput.startsWith('[') && trimmedOutput.endsWith(']'))) {
            
            const jsonObj = JSON.parse(trimmedOutput);
            return JSON.stringify(jsonObj, null, 2); // 2칸 들여쓰기로 beautify
          }
        } catch (e) {
          // JSON 파싱 실패시 원본 반환
        }
        
        // JSON이 아니거나 파싱 실패시 원본 반환
        return output;
      }

      async function executeCommand() {
        let command = commandLine.value.trim();

        // 커맨드가 비어있으면 리턴
        if (!command) return;

        try {
          // Desktop Commander를 통해 커맨드 실행
          const response = await window.electronAPI.executeCommand(command);
          
          // JSON 형식인지 확인하고 beautify
          const formattedResponse = formatOutput(response);
          
          // 기존 텍스트 위에 새로운 결과 추가 (최신이 위로)
          const timestamp = new Date().toLocaleTimeString();
          const newContent = `[${timestamp}] $ ${command}\n${formattedResponse}\n\n`;
          textArea.value = newContent + textArea.value;
        } catch (error) {
          // 에러가 발생한 경우
          const timestamp = new Date().toLocaleTimeString();
          const newContent = `[${timestamp}] $ ${command}\nError: ${error.message}\n\n`;
          textArea.value = newContent + textArea.value;
        }

        // 커맨드 라인 초기화
        commandLine.value = "";
      }



      // 커맨드라인에서 엔터키 이벤트
      commandLine.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          executeCommand();
        }
      });












    </script>
  </body>
</html>
